<IfModule mod_rewrite.c>
RewriteEngine On

# Force SSO: send native login to Auth0 unless ?local=1 is present
RewriteCond %{REQUEST_URI} ^/ucp\.php$ [NC]
RewriteCond %{QUERY_STRING} (^|&)mode=login(&|$) [NC]
RewriteCond %{QUERY_STRING} !(^|&)local=1(&|$) [NC]
RewriteRule ^ /ucp.php?mode=login&login=external&oauth_service=auth0 [R=302,L]

# Block local registration & password reset outright (change [F] to a redirect if you prefer)
RewriteCond %{REQUEST_URI} ^/ucp\.php$ [NC]
RewriteCond %{QUERY_STRING} (^|&)mode=(sendpassword|register)(&|$) [NC]
RewriteRule ^ - [F]
</IfModule>
