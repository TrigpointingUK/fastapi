#!/bin/bash
# Pre-commit hook to run CI checks
# To install: cp .githooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

set -e

echo "ğŸ” Running pre-commit CI checks..."

# Check if virtual environment is activated
if [[ "$VIRTUAL_ENV" == "" ]]; then
    echo "âš ï¸  Virtual environment not activated. Activating..."
    if [[ -f "venv/bin/activate" ]]; then
        source venv/bin/activate
    else
        echo "âŒ Virtual environment not found. Please run: python3 -m venv venv && source venv/bin/activate && make install-dev"
        exit 1
    fi
fi

# Run the full CI suite
echo "ğŸ§ª Running CI checks (this may take a moment)..."
if make ci; then
    echo "âœ… All CI checks passed! Proceeding with commit..."
else
    echo "âŒ CI checks failed! Please fix the issues before committing."
    echo "ğŸ’¡ Run 'make ci' to see detailed error messages."
    exit 1
fi
